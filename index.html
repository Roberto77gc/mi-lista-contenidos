<!DOCTYPE html>
<html lang="es" dir="ltr" data-pwa="false">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Seenly - Tu historial visual</title>
  <meta name="description" content="Organiza y gestiona tu historial de pelÃ­culas, series y documentales vistos o pendientes">

  <!-- SEO y Social -->
  <meta property="og:title" content="Seenly - Tu historial visual">
  <meta property="og:image" content="/mi-lista-contenidos/images/social-share.jpg">
  <meta property="og:url" content="https://tudominio.com/mi-lista-contenidos">
  
  <!-- PWA Meta -->
  <link rel="manifest" href="/mi-lista-contenidos/manifest.json" crossorigin="use-credentials">
  <meta name="theme-color" content="#3498db" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#2c3e50" media="(prefers-color-scheme: dark)">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Seenly">

  <!-- Iconos y Recursos -->
  <link rel="icon" href="/mi-lista-contenidos/icons/icon-192-any.png" sizes="192x192" type="image/png">
  <link rel="apple-touch-icon" href="/mi-lista-contenidos/icons/icon-192-any.png">
  <link rel="apple-touch-startup-image" href="/mi-lista-contenidos/icons/splash.png">

  <!-- Preloads y Fuentes -->
  <link rel="preload" href="/mi-lista-contenidos/style.css" as="style">
  <link rel="preload" href="/mi-lista-contenidos/script.js" as="script">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="/mi-lista-contenidos/style.css">
  
  <!-- Critical CSS -->
  <style>
    :root { --primary: #3498db; --background: #ffffff; }
    #splash-screen { 
      position: fixed; 
      top: 0; 
      left: 0; 
      width: 100%; 
      height: 100dvh; 
      background: var(--background); 
      z-index: 9999; 
      display: grid; 
      place-items: center; 
      animation: fadeOut 1s ease 2s forwards;
    }
    @keyframes fadeOut { to { opacity: 0; visibility: hidden; } }
  </style>
</head>

<body>
  <!-- Splash Screen -->
  <div id="splash-screen" role="status" aria-label="Cargando aplicaciÃ³n">
    <svg width="100" height="100" viewBox="0 0 100 100" aria-hidden="true">
      <circle cx="50" cy="50" r="40" stroke="#3498db" stroke-width="8" fill="none" stroke-linecap="round">
        <animateTransform attributeName="transform" type="rotate" from="0 50 50" to="360 50 50" dur="1.5s" repeatCount="indefinite"/>
      </circle>
    </svg>
  </div>

  <!-- App Shell -->
  <div id="app-container">
    <header role="banner">
      <h1>Seenly ðŸŽ¬</h1>
      <button id="boton-instalar" class="fab" aria-label="Instalar aplicaciÃ³n" hidden>
        <svg aria-hidden="true" width="24" height="24" viewBox="0 0 24 24">
          <path fill="currentColor" d="M19 12h-2v3h-3v2h5v-5M7 9h3V7H5v5h2V9m14-6H3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m-8 3h2v2h-2V6M9 6h2v2H9V6m6 12h-2v-2h2v2m-4 0H9v-2h2v2m4-4h-2v-2h2v2m-4 0H9v-2h2v2m-4-4H5V8h2v2m12 0h-2V8h2v2Z"/>
        </svg>
      </button>
    </header>

    <main role="main">
      <!-- Contenido principal -->
    </main>

    <!-- Notificaciones y Estado -->
    <div id="snackbar" role="alert" aria-live="assertive"></div>
    <div id="offline-status" role="alert" aria-live="polite" hidden>
      âš¡ Modo offline - Los cambios se guardarÃ¡n localmente
    </div>
  </div>

  <!-- Scripts -->
  <script src="/mi-lista-contenidos/script.js" defer></script>
  <script>
    // ===== SERVICE WORKER REGISTRATION =====
    if ('serviceWorker' in navigator) {
      const registerSW = async () => {
        try {
          const registration = await navigator.serviceWorker.register('/mi-lista-contenidos/sw.js');
          
          registration.addEventListener('updatefound', () => {
            const newWorker = registration.installing;
            newWorker.addEventListener('statechange', () => {
              if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                showUpdateNotification();
              }
            });
          });

          return registration;
        } catch (error) {
          console.error('SW registration failed:', error);
        }
      };

      const showUpdateNotification = () => {
        const snackbar = document.getElementById('snackbar');
        snackbar.textContent = 'Â¡Nueva versiÃ³n disponible! Haz clic para actualizar';
        snackbar.classList.add('show');
        snackbar.addEventListener('click', () => {
          window.location.reload();
          snackbar.classList.remove('show');
        });
      };

      window.addEventListener('load', registerSW);
    }

    // ===== PWA INSTALLATION HANDLER =====
    let deferredPrompt;
    const installButton = document.getElementById('boton-instalar');
    
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installButton.hidden = false;
      
      installButton.addEventListener('click', async () => {
        installButton.disabled = true;
        try {
          await deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          if (outcome === 'accepted') {
            console.log('PWA installed successfully');
            installButton.hidden = true;
          }
        } finally {
          deferredPrompt = null;
        }
      });
    });

    // ===== CONNECTIVITY HANDLING =====
    const updateOnlineStatus = () => {
      document.getElementById('offline-status').hidden = navigator.onLine;
    };
    
    window.addEventListener('online', () => {
      updateOnlineStatus();
      document.dispatchEvent(new Event('connectionRestored'));
    });
    
    window.addEventListener('offline', () => {
      updateOnlineStatus();
      document.dispatchEvent(new Event('connectionLost'));
    });

    // Initial status check
    updateOnlineStatus();
  </script>
</body>
</html>