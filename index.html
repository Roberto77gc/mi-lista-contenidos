<!DOCTYPE html>
<html lang="es" dir="ltr" data-pwa="false">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Seenly - Tu historial visual</title>
  <meta name="description" content="Organiza y gestiona tu historial de pelÃ­culas, series y documentales vistos o pendientes">

  <!-- SEO y Social -->
  <meta property="og:title" content="Seenly - Tu historial visual">
  <meta property="og:image" content="/mi-lista-contenidos/images/social-share.jpg">
  <meta property="og:url" content="https://tudominio.com/mi-lista-contenidos">
  
  <!-- PWA Meta -->
  <link rel="manifest" href="/mi-lista-contenidos/manifest.json" crossorigin="use-credentials">
  <meta name="theme-color" content="#3498db" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#2c3e50" media="(prefers-color-scheme: dark)">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Seenly">

  <!-- Iconos y Recursos -->
  <link rel="icon" href="/mi-lista-contenidos/icons/icon-192.png" sizes="192x192" type="image/png">
  <link rel="apple-touch-icon" href="/mi-lista-contenidos/icons/icon-192.png">
  <link rel="apple-touch-startup-image" href="/mi-lista-contenidos/icons/splash.png">

  <!-- Preloads y Fuentes -->
  <link rel="preload" href="/mi-lista-contenidos/style.css" as="style">
  <link rel="preload" href="/mi-lista-contenidos/script.js" as="script">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="/mi-lista-contenidos/style.css">
  
  <!-- Critical CSS -->
  <style>
    :root { --primary: #3498db; --background: #ffffff; }
    #splash-screen { 
      position: fixed; 
      top: 0; 
      left: 0; 
      width: 100%; 
      height: 100%; 
      background: var(--background); 
      z-index: 9999; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      animation: fadeOut 1s ease 2s forwards;
    }
    @keyframes fadeOut { to { opacity: 0; visibility: hidden; } }
  </style>
</head>

<body>
  <!-- Splash Screen -->
  <div id="splash-screen" role="status" aria-label="Cargando aplicaciÃ³n">
    <svg width="100" height="100" viewBox="0 0 100 100" aria-hidden="true">
      <circle cx="50" cy="50" r="40" stroke="#3498db" stroke-width="8" fill="none" stroke-linecap="round">
        <animateTransform attributeName="transform" type="rotate" from="0 50 50" to="360 50 50" dur="1.5s" repeatCount="indefinite"/>
      </circle>
    </svg>
  </div>

  <!-- App Shell -->
  <div id="app-container">
    <header role="banner">
      <h1>Seenly ðŸŽ¬</h1>
      <button id="boton-instalar" class="fab" aria-label="Instalar aplicaciÃ³n" hidden>
        <svg aria-hidden="true"><use href="#icon-download"/></svg>
      </button>
    </header>

    <main role="main">
      <!-- Formulario -->
      <section aria-labelledby="form-title" class="card">
        <h2 id="form-title" class="visually-hidden">AÃ±adir nuevo contenido</h2>
        <form id="formulario" class="grid-form">
          <!-- Campos del formulario mejorados -->
          <div class="form-group">
            <label for="tipo">Tipo de contenido</label>
            <select id="tipo" required>
              <option value="" hidden>Seleccionar...</option>
              <option value="PelÃ­cula">PelÃ­cula</option>
              <option value="Serie">Serie</option>
              <option value="Documental">Documental</option>
            </select>
          </div>
          
          <!-- Resto de campos con mejor semÃ¡ntica -->
        </form>
      </section>

      <!-- Listado y Filtros -->
      <section aria-labelledby="list-title">
        <div class="toolbar">
          <div role="search">
            <input id="buscador" type="search" placeholder="Buscar..." aria-label="Buscar en contenido">
          </div>
          <div class="filter-group">
            <!-- Filtros accesibles -->
          </div>
        </div>
        
        <!-- Lista con virtual scroll para mejor rendimiento -->
        <div id="lista-contenido" role="list" aria-label="Lista de contenidos" class="virtual-scroll">
          <!-- Template para items -->
          <template id="item-template">
            <li role="listitem" class="content-item">
              <div class="item-header">
                <h3 class="item-title"></h3>
                <span class="item-type"></span>
              </div>
              <!-- MÃ¡s detalles -->
            </li>
          </template>
        </div>
      </section>
    </main>

    <!-- Notificaciones y Estado -->
    <div id="snackbar" role="alert" aria-live="assertive"></div>
    <div id="offline-status" role="alert" aria-live="polite" hidden>âš¡ Modo offline</div>
  </div>

  <!-- Scripts -->
  <script src="/mi-lista-contenidos/script.js" defer></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // GestiÃ³n de estado PWA
      const updatePWAStatus = () => {
        const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
        document.documentElement.setAttribute('data-pwa', isStandalone);
      };
      
      // Service Worker con actualizaciones
      if ('serviceWorker' in navigator) {
        const registerSW = async () => {
          try {
            const reg = await navigator.serviceWorker.register('/mi-lista-contenidos/sw.js');
            
            reg.addEventListener('updatefound', () => {
              const newWorker = reg.installing;
              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  showUpdateAlert();
                }
              });
            });
          } catch (error) {
            console.error('SW registration failed:', error);
          }
        };

        const showUpdateAlert = () => {
          const snackbar = document.getElementById('snackbar');
          snackbar.textContent = 'Â¡Nueva versiÃ³n disponible!';
          snackbar.classList.add('show');
          snackbar.addEventListener('click', () => window.location.reload());
        };

        window.addEventListener('load', registerSW);
        navigator.serviceWorker.addEventListener('controllerchange', updatePWAStatus);
      }

      // GestiÃ³n offline
      const updateOnlineStatus = () => {
        document.getElementById('offline-status').hidden = navigator.onLine;
      };
      window.addEventListener('online', updateOnlineStatus);
      window.addEventListener('offline', updateOnlineStatus);
      updateOnlineStatus();

      // InstalaciÃ³n PWA mejorada
      let deferredPrompt;
      const installButton = document.getElementById('boton-instalar');
      
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        installButton.hidden = false;
        
        installButton.addEventListener('click', async () => {
          installButton.disabled = true;
          try {
            await deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            if (outcome === 'accepted') {
              ga('send', 'event', 'PWA', 'install');
            }
          } finally {
            deferredPrompt = null;
            installButton.hidden = true;
          }
        });
      });
    });
  </script>
</body>
</html>

